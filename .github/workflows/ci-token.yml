name: CI - Token (ICRC-1)

on:
  push:
    branches: [main]
    paths:
      - 'token/**'
      - '.github/workflows/ci-token.yml'
  pull_request:
    branches: [main]
    paths:
      - 'token/**'
      - '.github/workflows/ci-token.yml'
  workflow_dispatch:

env:
  ICP_DEV_IMAGE: ghcr.io/smart-social-contracts/icp-dev-env:db60540

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Run CI (lint + integration tests)
        run: |
          docker run --rm \
            -v "$(pwd):/workspace" \
            -w /workspace \
            ${{ env.ICP_DEV_IMAGE }} bash -c "
          set -e
          echo '=== Linting ==='
          pip install -q flake8 black isort
          ./token/scripts/run_linters.sh
          
          echo '=== Integration Tests (Token) ==='
          ./token/scripts/run_integration_tests.sh
          
          echo '=== Token CI passed! ==='"
