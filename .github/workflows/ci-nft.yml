name: CI - NFT (ICRC-7/ICRC-37)

on:
  push:
    branches: [main]
    paths:
      - 'nft/**'
      - '.github/workflows/ci-nft.yml'
  pull_request:
    branches: [main]
    paths:
      - 'nft/**'
      - '.github/workflows/ci-nft.yml'
  workflow_dispatch:

env:
  ICP_DEV_IMAGE: ghcr.io/smart-social-contracts/icp-dev-env:db60540

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Run CI (integration tests)
        run: |
          docker run --rm \
            -v "$(pwd):/workspace" \
            -w /workspace \
            ${{ env.ICP_DEV_IMAGE }} bash -c "
          set -e
          echo '=== Integration Tests (NFT) ==='
          cd nft && ./tests/integration/entrypoint.sh && cd ..
          
          echo '=== NFT CI passed! ==='"
